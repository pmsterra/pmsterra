terraform {
  required_providers {
    google = {
      source  = "hashicorp/google"
      version = ">= 7.13.0"
    }
  }
}

resource "google_discovery_engine_widget_config" "this" {
  location          = var.location
  collection        = var.collection
  data_store        = var.data_store
  widget_config_id  = var.widget_config_id

  language_code = var.language_code

  ################################
  # access_settings
  ################################
  dynamic "access_settings" {
    for_each = var.access_settings == null ? [] : [var.access_settings]
    content {
      allow_public_access               = access_settings.value.allow_public_access
      allowlisted_domains               = access_settings.value.allowlisted_domains
      enable_web_app                    = access_settings.value.enable_web_app
      workforce_identity_pool_provider  = access_settings.value.workforce_identity_pool_provider
    }
  }

  ################################
  # ui_settings
  ################################
  dynamic "ui_settings" {
    for_each = var.ui_settings == null ? [] : [var.ui_settings]
    content {
      interaction_type                     = ui_settings.value.interaction_type
      result_description_type              = ui_settings.value.result_description_type
      enable_autocomplete                  = ui_settings.value.enable_autocomplete
      enable_safe_search                   = ui_settings.value.enable_safe_search
      enable_quality_feedback              = ui_settings.value.enable_quality_feedback
      enable_search_as_you_type            = ui_settings.value.enable_search_as_you_type
      default_search_request_order_by      = ui_settings.value.default_search_request_order_by
      disable_user_events_collection       = ui_settings.value.disable_user_events_collection
      enable_visual_content_summary        = ui_settings.value.enable_visual_content_summary
      enable_people_search                 = ui_settings.value.enable_people_search
      enable_create_agent_button           = ui_settings.value.enable_create_agent_button

      ##############################
      # generative_answer_config
      ##############################
      dynamic "generative_answer_config" {
        for_each = ui_settings.value.generative_answer_config == null ? [] : [ui_settings.value.generative_answer_config]
        content {
          result_count                     = generative_answer_config.value.result_count
          model_version                    = generative_answer_config.value.model_version
          model_prompt_preamble            = generative_answer_config.value.model_prompt_preamble
          max_rephrase_steps               = generative_answer_config.value.max_rephrase_steps
          language_code                    = generative_answer_config.value.language_code
          disable_related_questions        = generative_answer_config.value.disable_related_questions
          ignore_non_answer_seeking_query  = generative_answer_config.value.ignore_non_answer_seeking_query
          ignore_adversarial_query         = generative_answer_config.value.ignore_adversarial_query
          ignore_low_relevant_content      = generative_answer_config.value.ignore_low_relevant_content
          image_source                     = generative_answer_config.value.image_source
        }
      }

      ##############################
      # data_store_ui_configs
      ##############################
      dynamic "data_store_ui_configs" {
        for_each = ui_settings.value.data_store_ui_configs
        content {
          name = data_store_ui_configs.value.name

          dynamic "facet_field" {
            for_each = data_store_ui_configs.value.facet_field
            content {
              field        = facet_field.value.field
              display_name = facet_field.value.display_name
            }
          }

          dynamic "fields_ui_components_map" {
            for_each = data_store_ui_configs.value.fields_ui_components_map
            content {
              ui_component      = fields_ui_components_map.value.ui_component
              field             = fields_ui_components_map.value.field
              device_visibility = fields_ui_components_map.value.device_visibility
              display_template  = fields_ui_components_map.value.display_template
            }
          }
        }
      }
    }
  }

  ################################
  # ui_branding
  ################################
  dynamic "ui_branding" {
    for_each = var.ui_branding == null ? [] : [var.ui_branding]
    content {
      dynamic "logo" {
        for_each = ui_branding.value.logo == null ? [] : [ui_branding.value.logo]
        content {
          url = logo.value.url
        }
      }
    }
  }

  ################################
  # homepage_setting
  ################################
  dynamic "homepage_setting" {
    for_each = var.homepage_setting == null ? [] : [var.homepage_setting]
    content {
      dynamic "shortcuts" {
        for_each = homepage_setting.value.shortcuts
        content {
          title           = shortcuts.value.title
          destination_uri = shortcuts.value.destination_uri

          dynamic "icon" {
            for_each = shortcuts.value.icon == null ? [] : [shortcuts.value.icon]
            content {
              url = icon.value.url
            }
          }
        }
      }
    }
  }
}





variables




  variable "location" {
  type        = string
  description = "Location of the Discovery Engine resource (e.g. global)"
}

variable "collection" {
  type        = string
  description = "Collection ID"
}

variable "data_store" {
  type        = string
  description = "Data store ID"
}

variable "widget_config_id" {
  type        = string
  description = "Widget config ID"
}

variable "language_code" {
  type        = string
  default     = "en-US"
}

################################
# access_settings
################################
variable "access_settings" {
  type = object({
    allow_public_access              = optional(bool)
    allowlisted_domains              = optional(list(string))
    enable_web_app                   = optional(bool)
    workforce_identity_pool_provider = optional(string)
  })
  default = null
}

################################
# ui_settings
################################
variable "ui_settings" {
  type = object({
    interaction_type                    = optional(string)
    result_description_type             = optional(string)
    enable_autocomplete                 = optional(bool)
    enable_safe_search                  = optional(bool)
    enable_quality_feedback             = optional(bool)
    enable_search_as_you_type           = optional(bool)
    default_search_request_order_by     = optional(string)
    disable_user_events_collection      = optional(bool)
    enable_visual_content_summary       = optional(bool)
    enable_people_search                = optional(bool)
    enable_create_agent_button          = optional(bool)

    generative_answer_config = optional(object({
      result_count                    = optional(number)
      model_version                   = optional(string)
      model_prompt_preamble           = optional(string)
      max_rephrase_steps              = optional(number)
      language_code                   = optional(string)
      disable_related_questions       = optional(bool)
      ignore_non_answer_seeking_query = optional(bool)
      ignore_adversarial_query        = optional(bool)
      ignore_low_relevant_content     = optional(bool)
      image_source                    = optional(string)
    }))

    data_store_ui_configs = optional(list(object({
      name = optional(string)

      facet_field = optional(list(object({
        field        = string
        display_name = optional(string)
      })))

      fields_ui_components_map = optional(list(object({
        ui_component      = string
        field             = string
        device_visibility = optional(list(string))
        display_template  = optional(string)
      })))
    })), [])
  })
  default = null
}

################################
# ui_branding
################################
variable "ui_branding" {
  type = object({
    logo = optional(object({
      url = optional(string)
    }))
  })
  default = null
}

################################
# homepage_setting
################################
variable "homepage_setting" {
  type = object({
    shortcuts = optional(list(object({
      title           = optional(string)
      destination_uri = optional(string)
      icon = optional(object({
        url = optional(string)
      }))
    })))
  })
  default = null
}




outputs

  output "name" {
  description = "Full resource name of the widget config"
  value       = google_discovery_engine_widget_config.this.name
}

output "id" {
  description = "Terraform resource ID"
  value       = google_discovery_engine_widget_config.this.id
}



readme.md

  # ðŸ“˜ Terraform Module: discovery_engine_widget_config

This Terraform module creates and manages a  
**Google Cloud Discovery Engine Widget Config** using the  
`google_discovery_engine_widget_config` resource.

It is designed for **GEN AI / Search / Agent Builder use cases** and supports:
- Search widget & web app access
- Generative answers
- UI behavior customization
- Branding & homepage shortcuts
- Per-data-store UI configuration

---

## ðŸ”§ Provider Requirements

| Name      | Version     |
|-----------|-------------|
| terraform | >= 1.3.0    |
| google    | >= 7.13.0   |

---

## ðŸ“¦ Resource Created

- `google_discovery_engine_widget_config`

---

## ðŸš€ Example Usage

```hcl
module "widget" {
  source = "./modules/discovery_engine_widget_config"

  location         = "global"
  collection       = "default_collection"
  data_store       = "default_data_store"
  widget_config_id = "search-widget"
  language_code    = "en-US"

  access_settings = {
    allow_public_access = true
    enable_web_app      = true
  }

  ui_settings = {
    interaction_type        = "SEARCH_WITH_ANSWER"
    enable_autocomplete     = true
    enable_safe_search      = true
    enable_quality_feedback = true

    generative_answer_config = {
      result_count  = 5
      model_version = "gemini-1.5-pro"
      image_source  = "ALL_AVAILABLE_SOURCES"
    }
  }
}


## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| access_settings | Access control configuration for the widget or web app. | <pre>object({<br>  allow_public_access = optional(bool)<br>  allowlisted_domains = optional(list(string))<br>  enable_web_app = optional(bool)<br>  workforce_identity_pool_provider = optional(string)<br>})</pre> | `null` | no |
| collection | Discovery Engine collection ID. | `string` | n/a | yes |
| data_store | Discovery Engine data store ID. | `string` | n/a | yes |
| homepage_setting | Homepage shortcuts configuration for the widget. | <pre>object({<br>  shortcuts = optional(list(object({<br>    title = optional(string)<br>    destination_uri = optional(string)<br>    icon = optional(object({<br>      url = optional(string)<br>    }))<br>  })))<br>})</pre> | `null` | no |
| language_code | Language code for the widget UI (BCP-47). | `string` | `"en-US"` | no |
| location | Location of the Discovery Engine resource (e.g. `global`). | `string` | n/a | yes |
| ui_branding | Branding configuration for the widget UI. | <pre>object({<br>  logo = optional(object({<br>    url = optional(string)<br>  }))<br>})</pre> | `null` | no |
| ui_settings | User interface behavior and search experience configuration. | <pre>object({<br>  interaction_type = optional(string)<br>  result_description_type = optional(string)<br>  enable_autocomplete = optional(bool)<br>  enable_safe_search = optional(bool)<br>  enable_quality_feedback = optional(bool)<br>  enable_search_as_you_type = optional(bool)<br>  default_search_request_order_by = optional(string)<br>  disable_user_events_collection = optional(bool)<br>  enable_visual_content_summary = optional(bool)<br>  enable_people_search = optional(bool)<br>  enable_create_agent_button = optional(bool)<br>  generative_answer_config = optional(object({<br>    result_count = optional(number)<br>    model_version = optional(string)<br>    model_prompt_preamble = optional(string)<br>    max_rephrase_steps = optional(number)<br>    language_code = optional(string)<br>    disable_related_questions = optional(bool)<br>    ignore_non_answer_seeking_query = optional(bool)<br>    ignore_adversarial_query = optional(bool)<br>    ignore_low_relevant_content = optional(bool)<br>    image_source = optional(string)<br>  }))<br>  data_store_ui_configs = optional(list(object({<br>    name = optional(string)<br>    facet_field = optional(list(object({<br>      field = string<br>      display_name = optional(string)<br>    })))<br>    fields_ui_components_map = optional(list(object({<br>      ui_component = string<br>      field = string<br>      device_visibility = optional(list(string))<br>      display_template = optional(string)<br>    })))<br>  })), [])<br>})</pre> | `null` | no |
| widget_config_id | Unique identifier for the widget configuration. | `string` | n/a | yes |

---

## Outputs

| Name | Description |
|------|-------------|
| id | Terraform resource ID |
| name | Full widget config resource name |

